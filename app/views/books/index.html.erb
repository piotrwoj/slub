<% if notice %>
<p id="notice"><%= notice %></p>
<% end %>
<% if alert %>
<p id="alert"><%= alert %></p>
<% end %>

<h1>Lista książek</h1>

<table>
  <thead>
    <tr>
      <th>Tytuł</th>
      <th>Autor</th>
      <th>Rezerwacja</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% my_book = Book.get_my(session)
       session[:reservation_id] = nil unless my_book %>
    <% @books.each do |book| %>
      <tr id="tr<%= book.id %>">
        <td><%= link_to book.title, book %></td>
        <td><%= book.author %></td>
        <td style="text-align:center">
          <% if book.reserved? %>
            <% if book != my_book %>
              TAK
            <% else %>
              <%= button_to 'Anuluj rezerwację', cancel_reservation_book_url(book) %>
            <% end %>
          <% else %>
            <% if my_book %>
              NIE
            <% else %>
              <%= button_to 'Rezerwuj', make_reservation_book_url(book) %>
            <% end %>
          <% end %>
        </td>

        <td>
        <%= link_to 'Pokaż', book %>
        <% if admin? %>
        <%= link_to 'Edytuj', edit_book_path(book) %>
        <%= link_to 'Usuń', book, remote: true, method: :delete, data: { confirm: 'Na pewno usunąć?' } %>
        <% end %>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>

<br>

<% if admin? %>
<%= link_to 'Dodaj książkę', new_book_path %>
<% end %>